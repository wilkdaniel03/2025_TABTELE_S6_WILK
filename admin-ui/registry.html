<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Container Registry - Admin UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 30px;
        }

        h1 {
            margin-bottom: 20px;
        }

        select {
            padding: 6px;
            min-width: 300px;
        }

        table {
            margin-top: 20px;
            border-collapse: collapse;
            background: #fff;
            min-width: 400px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 12px 12px;
            height: 40px;
            text-align: left;
        }

        th {
            background: #eee;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }
    </style>
</head>
<body>

    <h1>Private Container Registry – Admin UI</h1>

    <label for="repoSelect"><strong>Repository:</strong></label><br>
    <select id="repoSelect">
        <option value="">-- select repository --</option>
    </select>

    <table id="tagsTable">
        <thead>
            <tr>
                <th>Repository</th>
                <th>Tag</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const REGISTRY = "http://51.68.145.72:5000";
        const MIN_ROWS = 5;

        async function loadRepositories() {
            const select = document.getElementById("repoSelect");
            try {
                const res = await fetch(`${REGISTRY}/v2/_catalog`);
                const data = await res.json();
                (data.repositories || []).forEach(repo => {
                    const opt = document.createElement("option");
                    opt.value = repo;
                    opt.textContent = repo;
                    select.appendChild(opt);
                });
            } catch (err) {
                console.warn("Nie udało się pobrać listy repozytoriów:", err);
            }
        }

        function createEmptyRows(tbody, count) {
            for (let i = 0; i < count; i++) {
                const tr = document.createElement("tr");
                const tdRepo = document.createElement("td");
                tdRepo.textContent = "";
                tr.appendChild(tdRepo);
                const tdTag = document.createElement("td");
                tdTag.textContent = "";
                tr.appendChild(tdTag);
                tbody.appendChild(tr);
            }
        }

        async function loadTags(repo) {
            const table = document.getElementById("tagsTable");
            const tbody = table.querySelector("tbody");
            tbody.innerHTML = "";
            createEmptyRows(tbody, MIN_ROWS);

            if (!repo) return;

            try {
                const res = await fetch(`${REGISTRY}/v2/${repo}/tags/list`);
                const data = await res.json();
                const tags = data.tags || [];

                tags.forEach((tag, index) => {
                    let tr;
                    if (index < tbody.rows.length) {
                        tr = tbody.rows[index];
                    } else {
                        tr = document.createElement("tr");
                        const tdRepo = document.createElement("td");
                        tr.appendChild(tdRepo);
                        const tdTag = document.createElement("td");
                        tr.appendChild(tdTag);
                        tbody.appendChild(tr);
                    }
                    tr.cells[0].textContent = repo;
                    tr.cells[1].textContent = tag;
                });
            } catch (err) {
                console.warn("Nie udało się pobrać tagów:", err);
            }
        }

        document.getElementById("repoSelect").addEventListener("change", e => {
            loadTags(e.target.value);
        });

        loadRepositories();
        const tbody = document.getElementById("tagsTable").querySelector("tbody");
        createEmptyRows(tbody, MIN_ROWS);
    </script>

</body>
</html>
